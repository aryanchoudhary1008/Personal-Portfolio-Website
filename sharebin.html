<!DOCTYPE html>
<html>
<head>
  <title>ShareBin ✍️</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      max-width: 600px;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
    }
    .info {
      margin-top: 20px;
      font-size: 0.9rem;
      color: gray;
    }
  </style>
</head>
<body>
  <h1>ShareBin ✍️</h1>
  <textarea id="snippet" placeholder="Paste or write your text here..."></textarea><br>

  <label>
    <input type="checkbox" id="publicToggle" checked>
    Make Public
  </label><br>

  <button id="saveBtn">Save</button>
  <div class="info" id="infoText"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDHI0wNSU6VDoHX2tk3g2kRbp4kSrNch3g",
      authDomain: "portfolio-website-7a129.firebaseapp.com",
      projectId: "portfolio-website-7a129",
      storageBucket: "portfolio-website-7a129.firebasestorage.app",
      messagingSenderId: "600955832879",
      appId: "1:600955832879:web:1af519c5bd389a2de9d4da",
      measurementId: "G-C9JEX1M8WW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const snippetBox = document.getElementById('snippet');
    const saveBtn = document.getElementById('saveBtn');
    const infoText = document.getElementById('infoText');
    const publicToggle = document.getElementById('publicToggle');

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (id) {
      // View mode
      saveBtn.style.display = "none";
      publicToggle.style.display = "none";
      snippetBox.readOnly = true;
      const docRef = doc(db, "snippets", id);
      getDoc(docRef).then((docSnap) => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          snippetBox.value = data.content;
          infoText.innerText = `⏱️ Created At: ${data.createdAt?.toDate().toLocaleString() || 'Unknown'}`;
        } else {
          snippetBox.value = "❌ Snippet not found!";
        }
      });
    } else {
      // Save mode
      saveBtn.addEventListener("click", async () => {
        const content = snippetBox.value.trim();
        const isPublic = publicToggle.checked;

        if (!content) {
          alert("⚠️ Please write something first!");
          return;
        }

        const docRef = await addDoc(collection(db, "snippets"), {
          content,
          isPublic,
          createdAt: serverTimestamp()
        });

        const shareUrl = `${window.location.origin}${window.location.pathname}?id=${docRef.id}`;
        alert(`✅ Saved! Share this URL:\n${shareUrl}`);
      });
    }
  </script>
</body>
</html>
