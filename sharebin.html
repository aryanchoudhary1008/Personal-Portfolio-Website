<!DOCTYPE html>
<html>
<head>
  <title>ShareBin ‚úçÔ∏è</title>
  <style #loadingSpinner {
  font-size: 1rem;
  color: gray;
  display: none;
}>
    body {
      font-family: sans-serif;
      margin: 2rem;
      max-width: 600px;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
    }
    .info {
      margin-top: 20px;
      font-size: 0.9rem;
      color: gray;
    }
  </style>
</head>
<body>
  <div id="loadingSpinner">‚è≥ Loading...</div>
  
  <h1>ShareBin ‚úçÔ∏è</h1>
  <textarea id="snippet" placeholder="Paste or write your text here..."></textarea><br>

  <label>
    <input type="checkbox" id="publicToggle" checked>
    Make Public
  </label><br>

  <button id="saveBtn">Save</button>
  <button id="copyBtn" style="display:none;">Copy to Clipboard</button>
  <p id="toast" style="display:none; color: green;"></p>

  <div class="info" id="infoText"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDHI0wNSU6VDoHX2tk3g2kRbp4kSrNch3g",
      authDomain: "portfolio-website-7a129.firebaseapp.com",
      projectId: "portfolio-website-7a129",
      storageBucket: "portfolio-website-7a129.firebasestorage.app",
      messagingSenderId: "600955832879",
      appId: "1:600955832879:web:1af519c5bd389a2de9d4da",
      measurementId: "G-C9JEX1M8WW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const snippetBox = document.getElementById('snippet');
    const saveBtn = document.getElementById('saveBtn');
    const copyBtn = document.getElementById('copyBtn');
    const toast = document.getElementById('toast');
    const infoText = document.getElementById('infoText');
    const publicToggle = document.getElementById('publicToggle');

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (id) {
      // Read-only mode
      saveBtn.style.display = "none";
      publicToggle.style.display = "none";
      snippetBox.readOnly = true;
      copyBtn.style.display = "inline-block";

      const docRef = doc(db, "snippets", id);
      const loadingSpinner = document.getElementById("loadingSpinner");
      loadingSpinner.style.display = "block";

      getDoc(docRef).then((docSnap) => {
      loadingSpinner.style.display = "none";
  
      if (docSnap.exists()) {
      const data = docSnap.data();
      snippetBox.value = data.content;
      infoText.textContent = data.isPublic ? "üîì Public Snippet" : "üîí Private Snippet";
      } else {
      snippetBox.value = "Snippet not found!";
      copyBtn.style.display = "none";
    }
  });


      // Copy functionality
      copyBtn.addEventListener("click", () => {
        navigator.clipboard.writeText(snippetBox.value).then(() => {
          toast.textContent = "Copied!";
          toast.style.display = "block";
          setTimeout(() => (toast.style.display = "none"), 2000);
        });
      });
    } else {
      // Save mode
      saveBtn.addEventListener("click", async () => {
        const content = snippetBox.value;
        const isPublic = publicToggle.checked;

        if (!content.trim()) {
          alert("Please write something first!");
          return;
        }

        const docRef = await addDoc(collection(db, "snippets"), {
          content,
          isPublic,
          createdAt: serverTimestamp()
        });

        const shareUrl = `${window.location.origin}${window.location.pathname}?id=${docRef.id}`;
        alert(`‚úÖ Saved! Share this URL:\n${shareUrl}`);
        window.location.href = shareUrl;
      });
    }
  </script>
</body>
</html>
